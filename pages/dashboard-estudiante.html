<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSP Â· Dashboard Estudiante</title>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary-700:#1d4ed8; --primary-600:#2563eb; --primary-500:#3b82f6; --primary-400:#60a5fa;
      --gray-900:#111827; --gray-800:#1f2937; --gray-700:#374151; --gray-600:#4b5563; --gray-500:#6b7280;
      --gray-300:#d1d5db; --gray-200:#e5e7eb; --gray-100:#f3f4f6; --gray-50:#fafafa; --white:#fff;
      --success-500:#10b981; --warning-500:#f59e0b; --error-500:#ef4444;
      --radius:16px; --shadow:0 10px 25px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--gray-100);color:var(--gray-800)}

    /* HEADER */
    .topbar{position:sticky;top:0;z-index:50;background:linear-gradient(135deg,var(--primary-600),var(--primary-700));color:#fff;border-bottom:1px solid rgba(255,255,255,.15)}
    .topbar .wrap{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:16px;padding:16px}
    .brand{font-weight:800;letter-spacing:.2px}
    .brand small{opacity:.9;font-weight:600}
    .userbox{display:flex;align-items:center;gap:12px}
    .userbox .avatar{width:32px;height:32px;border-radius:50%;background:#fff1;display:inline-flex;align-items:center;justify-content:center;border:1px solid #fff3}
    .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn.light{background:#fff1;color:#fff;border:1px solid #fff3}
    .btn.light:hover{background:#fff2}

    /* MAIN */
    .container{max-width:1200px;margin:24px auto;padding:0 16px}
    .section{background:var(--white);border:1px solid var(--gray-200);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-bottom:20px}

    .section-title{margin:0 0 14px 0;font-weight:800;color:var(--gray-900);display:flex;align-items:center;gap:10px}
    .section-title::before{content:"";width:6px;height:26px;border-radius:4px;background:linear-gradient(180deg,var(--primary-500),var(--primary-700))}

    .grid{display:grid;gap:16px}
    .grid.modules{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .grid.results{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}

    /* CARD MÃ“DULO */
    .module-card{border:1px solid var(--gray-200);border-radius:18px;background:linear-gradient(135deg,var(--gray-50),#fff);padding:22px;box-shadow:var(--shadow);transition:.2s;cursor:pointer}
    .module-card:hover{transform:translateY(-4px);border-color:var(--primary-400)}
    .module-icon{font-size:38px;margin-bottom:8px}
    .module-title{margin:0;font-weight:800;color:var(--gray-900)}
    .module-desc{margin:6px 0 14px;color:var(--gray-600)}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--gray-300);font-size:.85rem;color:var(--gray-700);margin-bottom:12px}
    .pill.pending{background:#fff3c2;border-color:#facc15;color:#a16207}
    .pill.completed{background:#d1fae5;border-color:#34d399;color:#065f46}
    .module-actions{display:flex;gap:8px}
    .btn.primary{background:linear-gradient(135deg,var(--primary-600),var(--primary-500));color:#fff}
    .btn.primary:hover{filter:brightness(1.05)}
    .btn.ghost{background:transparent;border:1px solid var(--gray-300);color:var(--gray-800)}
    .btn.ghost:hover{background:var(--gray-100)}

    /* CARD RESULT */
    .result-card{border:1px solid var(--gray-200);border-radius:18px;background:#fff;padding:18px}
    .result-card h4{margin:0 0 8px 0;color:var(--primary-700)}
    .muted{color:var(--gray-600);font-size:.9rem}
    .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    .metric{border:1px solid var(--gray-200);border-radius:14px;padding:10px;text-align:center}
    .metric .v{font-weight:800;font-size:1.2rem}

    /* BANNER ÃšLTIMO RESULTADO */
    .last-result{display:none;margin-bottom:16px;border:1px solid var(--gray-200);border-radius:18px;background:#fff;padding:16px;box-shadow:var(--shadow)}
    .last-result.show{display:block}
    .last-result h3{margin:0 0 6px 0}
    .last-result .mini{color:var(--gray-600);font-size:.9rem}

    /* USER INFO */
    .user-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
    .user-item{border:1px solid var(--gray-200);border-radius:14px;background:#fff;padding:14px;text-align:center}
    .user-item .label{font-size:.8rem;color:var(--gray-600);text-transform:uppercase;letter-spacing:.04em}
    .user-item .value{font-weight:800;color:var(--gray-900);margin-top:4px}

    @media (max-width:720px){ .metrics{grid-template-columns:repeat(2,1fr)} }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="topbar">
    <div class="wrap">
      <div class="brand">
        <div>TSP Â· <small>Dashboard Estudiante</small></div>
        <div id="today" style="font-size:.9rem;opacity:.9"></div>
      </div>
      <div class="userbox">
        <div class="avatar">ðŸ‘¤</div>
        <div id="welcome">Bienvenido/a</div>
        <button class="btn light" id="btnLogout">Cerrar sesiÃ³n</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">

    <!-- ÃšLTIMO RESULTADO (banner) -->
    <section id="lastResult" class="last-result" aria-live="polite">
      <h3>ðŸ“Š Ãšltimo resultado</h3>
      <div id="lastResultMeta" class="mini">â€”</div>
      <div class="metrics" style="margin-top:8px">
        <div class="metric"><div class="v" id="lrWpm">â€”</div><div>WPM</div></div>
        <div class="metric"><div class="v" id="lrCompr">â€”</div><div>% ComprensiÃ³n</div></div>
        <div class="metric"><div class="v" id="lrVE">â€”</div><div>VE</div></div>
        <div class="metric"><div class="v" id="lrTime">â€”</div><div>Tiempo</div></div>
      </div>
    </section>

    <!-- INFO DEL ESTUDIANTE -->
    <section class="section">
      <h2 class="section-title">InformaciÃ³n del estudiante</h2>
      <div class="user-grid">
        <div class="user-item"><div class="label">CÃ³digo</div><div class="value" id="uCodigo">â€”</div></div>
        <div class="user-item"><div class="label">Grado</div><div class="value" id="uGrado">â€”</div></div>
        <div class="user-item"><div class="label">InstituciÃ³n</div><div class="value" id="uInst">â€”</div></div>
      </div>
    </section>

    <!-- MÃ“DULOS -->
    <section class="section">
      <h2 class="section-title">MÃ³dulos de entrenamiento</h2>
      <div class="grid modules">
        <!-- MLC -->
        <article class="module-card" tabindex="0" role="button" data-module="MLC" aria-label="Abrir mÃ³dulo Lectura CrÃ­tica">
          <div class="module-icon">ðŸ“š</div>
          <span class="pill in-progress" id="mlcPill">Pendiente</span>
          <h3 class="module-title">Lectura CrÃ­tica</h3>
          <p class="module-desc">ComprensiÃ³n lectora y velocidad</p>
          <div class="module-actions">
            <button class="btn primary" data-module="MLC">Iniciar</button>
            <button class="btn ghost" data-module="MLC">Ver resultados</button>
          </div>
        </article>

        <!-- MDM -->
        <article class="module-card" tabindex="0" role="button" data-module="MDM" aria-label="Abrir mÃ³dulo DesafÃ­os Mentales">
          <div class="module-icon">ðŸ§ </div>
          <span class="pill pending" id="mdmPill">Pendiente</span>
          <h3 class="module-title">DesafÃ­os Mentales</h3>
          <p class="module-desc">Creatividad y pensamiento lÃ³gico</p>
          <div class="module-actions">
            <button class="btn ghost" data-module="MDM">PrÃ³ximamente</button>
          </div>
        </article>

        <!-- MED -->
        <article class="module-card" tabindex="0" role="button" data-module="MED" aria-label="Abrir mÃ³dulo Ejercicios Digitales">
          <div class="module-icon">ðŸŽ®</div>
          <span class="pill pending" id="medPill">Pendiente</span>
          <h3 class="module-title">Ejercicios Digitales</h3>
          <p class="module-desc">Fortalece inteligencias mÃºltiples</p>
          <div class="module-actions">
            <button class="btn ghost" data-module="MED">PrÃ³ximamente</button>
          </div>
        </article>
      </div>
    </section>

    <!-- RESULTADOS RECIENTES -->
    <section class="section">
      <h2 class="section-title">Resultados recientes</h2>
      <div class="grid results">
        <div class="result-card">
          <h4>Lectura CrÃ­tica</h4>
          <div id="lastMlcBox" class="muted">No hay resultados recientes</div>
        </div>
        <div class="result-card">
          <h4>DesafÃ­os Mentales</h4>
          <div class="muted">PrÃ³ximamenteâ€¦</div>
        </div>
        <div class="result-card">
          <h4>Ejercicios Digitales</h4>
          <div class="muted">PrÃ³ximamenteâ€¦</div>
        </div>
      </div>
    </section>

    <!-- (Lugar para futuros grÃ¡ficos) -->

  </main>

  <script>
    // ========= UTILIDADES =========
    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>document.querySelectorAll(s);
    const fmtDateTime = (d)=>new Date(d).toLocaleString('es-CO',{dateStyle:'medium', timeStyle:'short'});
    const fmtMinutes = (ms)=> (ms>0? (ms/1000/60).toFixed(2)+' min' : '0.00 min');

    // ========= ESTADO =========
    let currentUser = null;

    // ========= INICIO =========
    document.addEventListener('DOMContentLoaded', () => {
      hydrateUser();
      paintHeader();
      paintUserInfo();
      wireModules();
      paintLastResultFromLocalStorage();
      // marca de estado del mÃ³dulo en la pastilla
      updateMlcPill();
      // logout
      $('#btnLogout').addEventListener('click', onLogout);
    });

    // Obtiene el usuario (de sessionStorage) y lo refleja en localStorage para el MLC
    function hydrateUser(){
      try{
        const raw = sessionStorage.getItem('tsp_user');
        currentUser = raw? JSON.parse(raw) : {
          id:'user-demo', codigo_estudiante:'E001002',
          nombres:'Estudiante', apellidos:'Demo',
          grado: 5, seccion: 'A', institucion: 'Colegio San JosÃ©'
        };
        localStorage.setItem('tsp_user', JSON.stringify(currentUser));
      }catch(e){ console.warn(e); }
    }

    function paintHeader(){
      $('#welcome').textContent = `Bienvenido/a ${currentUser.nombres} ${currentUser.apellidos}`;
      $('#today').textContent = new Date().toLocaleString('es-CO',{weekday:'long', year:'numeric', month:'long', day:'numeric', hour:'2-digit', minute:'2-digit'});
    }

    function paintUserInfo(){
      $('#uCodigo').textContent = currentUser.codigo_estudiante || 'â€”';
      $('#uGrado').textContent  = `${currentUser.grado || '-'}Â°${currentUser.seccion || ''}`;
      $('#uInst').textContent   = currentUser.institucion || 'â€”';
    }

    // Enlaza todos los cards/botones al openModule
    function wireModules(){
      $$('.module-card,[data-module],.module-actions .btn').forEach(el=>{
        el.addEventListener('click', (ev)=>{
          const m = el.dataset.module || el.closest('[data-module]')?.dataset.module;
          if(!m) return;
          openModule(m);
        });
        el.addEventListener('keydown',(ev)=>{
          if(ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); el.click(); }
        });
      });
    }

    // NavegaciÃ³n a mÃ³dulos
    function openModule(moduleType){
      const urls = { MLC:'./mlc-module.html', MDM:'#', MED:'#' };
      const url = urls[moduleType]; if(!url || url==='#'){ alert('PrÃ³ximamente'); return; }
      // ya dejamos tsp_user en localStorage en hydrateUser()
      window.location.href = url;
    }

    // Ãšltimo resultado (de localStorage:tsp_last_result) â†’ banner y card
    function paintLastResultFromLocalStorage(){
      try{
        const raw = localStorage.getItem('tsp_last_result');
        if(!raw) return;
        const r = JSON.parse(raw);
        // banner
        $('#lastResultMeta').textContent = `${r.titulo || 'Lectura'} Â· ${fmtDateTime(r.session_date || Date.now())}`;
        $('#lrWpm').textContent   = Math.round(r.palabras_por_minuto || 0);
        $('#lrCompr').textContent = `${Math.round(r.porcentaje_comprension || 0)}%`;
        $('#lrVE').textContent    = Math.round(r.velocidad_efectiva || 0);
        $('#lrTime').textContent  = fmtMinutes(r.tiempo_lectura_ms || 0);
        $('#lastResult').classList.add('show');

        // card de resultados recientes (MLC)
        $('#lastMlcBox').innerHTML = `
          <div><strong>${r.titulo || 'Lectura'}</strong></div>
          <div class="muted">${fmtDateTime(r.session_date || Date.now())}</div>
          <div class="metrics" style="margin-top:10px">
            <div class="metric"><div class="v">${Math.round(r.palabras_por_minuto||0)}</div><div>WPM</div></div>
            <div class="metric"><div class="v">${Math.round(r.porcentaje_comprension||0)}%</div><div>%</div></div>
            <div class="metric"><div class="v">${Math.round(r.velocidad_efectiva||0)}</div><div>VE</div></div>
            <div class="metric"><div class="v">${fmtMinutes(r.tiempo_lectura_ms||0)}</div><div>Tiempo</div></div>
          </div>
        `;
      }catch(e){ console.warn(e); }
    }

    // Actualiza el estado de la pastilla del MLC segÃºn si existe Ãºltimo resultado
    function updateMlcPill(){
      const has = !!localStorage.getItem('tsp_last_result');
      const pill = $('#mlcPill');
      if(has){ pill.textContent='Completado'; pill.classList.remove('in-progress'); pill.classList.add('completed'); }
      else { pill.textContent='Pendiente'; pill.classList.remove('completed'); pill.classList.add('in-progress'); }
    }

    // Logout
    function onLogout(){
      if(!confirm('Â¿Deseas cerrar sesiÃ³n?')) return;
      try{ sessionStorage.clear(); localStorage.clear(); }catch{}
      window.location.href = '../index.html';
    }
  </script>
</body>
</html>
