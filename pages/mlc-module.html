<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSP · Módulo de Lectura Crítica</title>

  <link rel="stylesheet" href="../css/dashboard.css" />
  <link rel="stylesheet" href="../css/mlc.css?v=6" />

  <!-- Topbar y Modal (garantizamos estilos) -->
  <style>
    .mlc-topbar{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid #e5e7eb;backdrop-filter:saturate(180%) blur(6px)}
    .mlc-topbar .wrap{max-width:1100px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .mlc-topbar .btn.link{background:transparent;border:none;padding:6px 8px;color:#1d4ed8;font-weight:600;cursor:pointer}
    .mlc-title{font-weight:700;letter-spacing:.2px;color:#111827}
    .mlc-user{display:inline-flex;align-items:center;gap:8px;color:#374151}
    .mlc-user .avatar{width:28px;height:28px;border-radius:50%;background:#f3f4f6;display:inline-flex;align-items:center;justify-content:center;font-size:.95rem;border:1px solid #e5e7eb}

    /* Modal de resultados */
    .mlc-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(17,24,39,.45)}
    .mlc-modal.show{display:flex}
    .mlc-modal .win{width:min(720px,92vw);background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 20px 40px rgba(0,0,0,.18);padding:20px}
    .mlc-modal h3{margin:0 0 12px 0}
    .mlc-modal .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:12px 0}
    .mlc-modal .metric{padding:12px;border:1px solid #e5e7eb;border-radius:12px;text-align:center}
    .mlc-modal .metric .v{font-size:1.5rem;font-weight:800}
    .mlc-modal .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:8px}

    /* Fullscreen con scroll */
    :fullscreen, :-webkit-full-screen { overflow:auto !important }
    #step3:fullscreen,#step4:fullscreen{width:100%;height:100%;overflow:auto!important}
    #step3:-webkit-full-screen,#step4:-webkit-full-screen{width:100%;height:100%;overflow:auto!important}
  </style>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Topbar -->
  <header class="mlc-topbar">
    <div class="wrap">
      <a class="btn link" href="./dashboard-estudiante.html">← Volver</a>
      <div class="mlc-title">📚 Módulo de Lectura Crítica</div>
      <div class="mlc-user"><span class="avatar">👤</span><span id="studentName">Estudiante</span></div>
    </div>
  </header>

  <main class="mlc-container">
    <!-- Progreso -->
    <div class="module-card" style="margin-bottom:1rem">
      <div class="mlc-progress"><div id="mlcBar" class="mlc-progress-bar"></div></div>
      <div class="mlc-steps">
        <div id="st1" class="mlc-step"><span class="mlc-n">1</span>Vocabulario</div>
        <div id="st2" class="mlc-step"><span class="mlc-n">2</span>Test Vocabulario</div>
        <div id="st3" class="mlc-step"><span class="mlc-n">3</span>Lectura</div>
        <div id="st4" class="mlc-step"><span class="mlc-n">4</span>Comprensión</div>
      </div>
    </div>

    <!-- PASO 1 -->
    <section id="step1" class="section module-card active">
      <h2>📗 Estudio de vocabulario</h2>
      <div class="reading-head" style="margin-bottom:.5rem">
        <div>
          <strong id="readingTitleS1">—</strong>
          <div id="readingMetaS1">—</div>
        </div>
      </div>
      <div id="vocabList" class="vocab-grid"></div>
      <div class="actions" style="margin-top:1rem;display:flex;gap:12px;justify-content:center">
        <button id="btnNextToVocabTest" class="btn primary">Siguiente</button>
      </div>
    </section>

    <!-- PASO 2 -->
    <section id="step2" class="section module-card">
      <h2>🧩 Test de vocabulario</h2>
      <div id="vocabTest" style="margin-top:1rem"></div>
      <div class="actions" style="display:flex;gap:12px;justify-content:center">
        <button id="btnSubmitVocab" class="btn primary" disabled>Registrar respuestas</button>
        <button id="btnBackToVocab" class="btn">← Regresar a vocabulario</button>
      </div>
      <div id="vocabScore" style="display:none;text-align:center;margin-top:.75rem"></div>
      <div id="gateToReading" style="display:none;text-align:center;margin-top:1rem">
        <p style="margin-bottom:.5rem"><strong>¡Perfecto! 10/10 en vocabulario.</strong></p>
        <button id="btnOpenReading" class="btn primary">Abrir lectura</button>
      </div>
      <div id="retryVocab" style="display:none;text-align:center;margin-top:1rem">
        <p style="margin-bottom:.5rem">Necesitas 10/10 para abrir la lectura. Estudia nuevamente y reintenta.</p>
        <button id="btnStudyAgain" class="btn">📗 Estudiar nuevamente</button>
      </div>
    </section>

    <!-- PASO 3 -->
    <section id="step3" class="section module-card">
      <h2>📖 Lectura</h2>
      <div class="reading-head">
        <div>
          <strong id="readingTitle">—</strong>
          <div id="readingMeta">—</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <button id="btnToggleFullRead" class="btn">⛶ Pantalla completa</button>
          <button id="btnFinishReadTop" class="btn primary">Terminé de leer</button>
          <button id="btnMinimizeReadTop" class="btn">Minimizar</button>
          <div id="timer">00:00</div>
        </div>
      </div>
      <iframe id="pdfFrame" class="pdf" title="PDF de la lectura"></iframe>
      <div class="actions" style="display:flex;gap:12px;justify-content:center;margin-top:16px">
        <button id="btnMinimizeRead" class="btn">Minimizar (volver a vocabulario)</button>
        <button id="btnFinishRead" class="btn primary">Terminé de leer</button>
      </div>
    </section>

    <!-- PASO 4 -->
    <section id="step4" class="section module-card">
      <h2>🧠 Test de comprensión lectora</h2>
      <div style="display:flex;justify-content:space-between;align-items:center;margin:.5rem 0 1rem">
        <button id="btnToggleFullComp" class="btn">⛶ Pantalla completa</button>
        <button id="btnBackToVocabFromComp" class="btn">Minimizar (ver vocabulario)</button>
      </div>
      <div id="comprension"></div>
      <div class="actions" style="display:flex;gap:12px;justify-content:center">
        <button id="btnSubmitComprension" class="btn primary" disabled>Registrar respuestas</button>
      </div>

      <!-- Footer cuando el estudiante decide revisar -->
      <div id="reviewFooter" class="actions" style="display:none;justify-content:center;margin-top:16px">
        <a href="./dashboard-estudiante.html" class="btn success">Ir al dashboard</a>
      </div>
    </section>
  </main>

  <!-- MODAL de resultados -->
  <div id="resultsModal" class="mlc-modal" role="dialog" aria-modal="true" hidden>
    <div class="win">
      <h3>🎉 Resultados</h3>
      <div id="resTitle" style="color:#6b7280;margin-bottom:6px">—</div>
      <div class="metrics">
        <div class="metric"><div class="v" id="rWpm">—</div><div>Velocidad simple (WPM)</div></div>
        <div class="metric"><div class="v" id="rCompr">—</div><div>% Comprensión</div></div>
        <div class="metric"><div class="v" id="rVE">—</div><div>Velocidad efectiva (VE)</div></div>
        <div class="metric"><div class="v" id="rTime">—</div><div>Tiempo de lectura</div></div>
      </div>
      <div class="actions">
        <button id="btnModalReview" class="btn">Revisar respuestas</button>
        <a id="btnModalDashboard" class="btn success" href="./dashboard-estudiante.html">Ir al dashboard</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../js/mlc-module.js?v=6"></script>
</body>
</html>
